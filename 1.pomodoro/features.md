# ポモドーロタイマー — 実装すべき機能一覧

以下は本アプリで実装するユーザー向け機能の一覧です。MVP 実装や将来的な拡張の指針として使ってください。

## 1. 基本タイマー機能
- 作業タイマー（デフォルト 25 分）のカウントダウン表示
- 短い休憩タイマー（デフォルト 5 分）のカウントダウン表示
- 長い休憩タイマー（デフォルト 15 分／設定可）のカウントダウン表示
- モード切替（作業 / 休憩（短）/ 休憩（長））

## 2. 操作（ユーザー操作）
- 開始（Start）: タイマー開始
- 一時停止（Pause）: カウントダウンを停止（再開可能）
- リセット（Reset）: 現在のモード時間へ戻す
- スキップ（Skip）: 次のモードへ移行
- 自動開始トグル: 次セッション自動開始のオン/オフ

## 3. 表示要素（UI）
- 円形プログレスバー（残り時間の視覚化）
- 大きな残り時間表示（MM:SS）
- 現在のモードラベル（例: 「作業中」「休憩中」）
- 操作用ボタン（開始／一時停止／リセット／スキップ）
- 今日の進捗カード（完了セッション数、合計集中時間）
- セッション履歴（直近 N 件）／日別集計へのリンク
- 設定アイコン（時間・サウンド・通知・テーマ）

## 4. 永続化と同期
- localStorage に途中状態を保存（モード・残り時間・開始時刻等）
- 完了セッションのみサーバへ POST `/api/session` で送信
  - 送信データ: `{ start_ts, end_ts, duration_sec, kind }`
- 日次集計は GET `/api/stats?date=YYYY-MM-DD` で取得
- ネットワーク不通時はローカルにキュー保管し再接続時に再送

## 5. 設定項目（ユーザー変更可）
- 作業／短休憩／長休憩の時間設定
- 長休憩の発生間隔（例: 4 回ごと）
- サウンドのオン/オフ、通知のオン/オフ
- テーマ（ライト/ダーク）
- 自動開始のオン/オフ

## 6. 通知とサウンド
- ブラウザ通知（Web Notifications API）でセッション終了を通知
- サウンド再生（ベル等）／ミュート可能
- フォーカス外や画面オフ時の通知対応

## 7. アクセシビリティ & 操作性
- キーボードショートカット（開始/停止: Space、リセット: R など）
- 適切な ARIA 属性とフォーカス管理
- 色コントラストに配慮したデザイン

## 8. エッジケースと耐障害性
- タブ非アクティブやスリープ復帰時の時刻ズレ補正（`now()` 注入）
- 同一ブラウザ複数タブでの競合防止（ロック/リーダー制御）
- 端末時刻変更への耐性

## 9. テスト性（実装上の配慮）
- タイマーの時刻取得を注入可能にして単体テストを容易にする（`static/js/timer.js`）
- localStorage の読み書きをラップしてモック可能にする（`static/js/storage.js`）
- 完了送信ロジックは再送キューを持ち、UI は再送中/失敗を可視化

## 10. 実装マッピング（ファイル案）
- サーバ: `1.pomodoro/app.py`（`create_app`）
- API: `1.pomodoro/api/`（`POST /api/session`, `GET /api/stats`）
- テンプレート: `1.pomodoro/templates/index.html`
- フロント: `1.pomodoro/static/js/timer.js`, `main.js`, `storage.js`
- スタイル: `1.pomodoro/static/css/`

## 11. ユーザーフロー（要点）
- セッション開始 → プログレス表示 → 終了で通知とサーバ保存 → 今日の進捗更新
- ページ更新や誤閉じからの復帰は localStorage により可能

## 12. MVP（最小実装）優先項目
1. `create_app` + `templates/index.html`（簡易 UI）
2. `static/js/timer.js`（開始／一時停止／リセット・`now()` 注入可能）
3. localStorage による復帰
4. `POST /api/session`（完了セッション送信、失敗時のローカルキュー）
5. 今日の進捗カード（`GET /api/stats` から取得）

---

必要ならこの `features.md` からさらにタスク分解（小さなコミット単位）を作成します。
